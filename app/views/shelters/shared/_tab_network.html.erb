<!-- app/views/shelters/shared/_tab_network.html.erb -->

<div class="space-y-6">
  <!-- Header -->
  <div class="space-y-1">
    <h2 class="text-lg font-semibold text-slate-900">Shelter Network</h2>
    <p class="text-sm text-slate-600">
      Nearby shelters and partners. Use the map or list to see who has space available.
    </p>
  </div>

  

  <!-- Map -->
  <div
    class="h-80 w-full rounded-2xl overflow-hidden bg-slate-100 border border-slate-200"
    data-controller="network-map"
    data-network-map-home-latitude-value="<%= @shelter.latitude %>"
    data-network-map-home-longitude-value="<%= @shelter.longitude %>"
    data-network-map-shelters-value="<%= @network_shelters.map { |s|
      {
        id: s.id,
        name: s.name,
        address: s.address,
        latitude: s.latitude,
        longitude: s.longitude,
        vacancies: s.total_available,
        capacity: s.total_capacity
      }
    }.to_json %>">
  </div>
  <!-- Legend -->
  <div class="flex flex-wrap items-center gap-4 text-xs text-slate-600 mt-2">
    <div class="flex items-center gap-1">
      <span class="inline-block h-2.5 w-2.5 rounded-full bg-blue-500"></span>
      Home Shelter
    </div>
    <div class="flex items-center gap-1">
      <span class="inline-block h-2.5 w-2.5 rounded-full bg-emerald-500"></span>
      Plenty of space
    </div>
    <div class="flex items-center gap-1">
      <span class="inline-block h-2.5 w-2.5 rounded-full bg-amber-400"></span>
      Limited space
    </div>
    <div class="flex items-center gap-1">
      <span class="inline-block h-2.5 w-2.5 rounded-full bg-red-500"></span>
      No vacancies
    </div>
  </div>

  <!-- Controls + list -->
  <div class="space-y-4">
    <!-- Sort/filter controls -->
    <div class="flex flex-wrap items-center justify-between gap-3">
      <%= form_with url: shelter_path(@shelter), method: :get, local: true, class: "flex flex-wrap items-center gap-3 text-sm" do %>
        <%= hidden_field_tag :tab, "network" %>

        <div class="flex items-center gap-2">
          <label for="sort" class="font-medium text-slate-700">Sort by:</label>
          <%= select_tag :sort,
                options_for_select(
                  [
                    ["Distance", "distance"],
                    ["Vacancies", "vacancy"],
                    ["Capacity", "capacity"]
                  ],
                  params[:sort]
                ),
                class: "border border-slate-300 rounded-lg px-2 py-1 text-sm bg-white" %>
        </div>

        <div class="flex items-center gap-2">
          <%= check_box_tag :only_with_vacancies, "1", params[:only_with_vacancies] == "1", class: "rounded border-slate-300" %>
          <label for="only_with_vacancies" class="text-slate-700">
            Only show shelters with vacancies
          </label>
        </div>

        <%= submit_tag "Apply",
              class: "px-3 py-1.5 rounded-lg bg-slate-900 text-white font-medium hover:bg-slate-800" %>
      <% end %>

      <p class="text-xs text-slate-500">
        Showing <%= @network_shelters.size %> shelters.
      </p>
    </div>

    <!-- List -->
    <div class="space-y-3">
      <% @network_shelters.each do |s| %>
        <div class="bg-white rounded-2xl border border-slate-100 px-4 py-3 shadow-sm flex items-center justify-between gap-4">
          <div>
            <div class="font-semibold text-slate-900"><%= s.name %></div>
            <div class="text-xs text-slate-500"><%= s.address %></div>
          </div>

          <div class="flex items-center gap-6 text-sm">
            <div class="text-right">
              <div class="text-xs uppercase tracking-wide text-slate-500">Capacity</div>
              <div class="font-semibold text-slate-900"><%= s.total_capacity %></div>
            </div>

            <div class="text-right">
              <div class="text-xs uppercase tracking-wide text-slate-500">Vacancies</div>
              <div class="font-semibold <%= (s.total_available || 0) > 0 ? 'text-emerald-600' : 'text-slate-900' %>">
                <%= s.total_available || 0 %>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <% if @network_shelters.empty? %>
        <p class="text-sm text-slate-500">
          No other shelters found. Try adjusting filters or adding more shelters.
        </p>
      <% end %>
    </div>
  </div>
</div>
